""" This file processes W5E5 data to the required format to run in OGGM """ #%% Cell 0: Import required packagesimport pandas as pdimport xarray as xr#%% Cell 1: Open target formal fileformat_data_path = "/Users/magaliponds/Library/CloudStorage/OneDrive-VrijeUniversiteitBrussel/1. VUB/02. Coding/01. IRRMIP/03. Data/01. Input files/W5E5/format_datafile_histalp_merged_hef.nc"format_data = xr.open_dataset(format_data_path)climate_data_path = "/Users/magaliponds/Library/CloudStorage/OneDrive-VrijeUniversiteitBrussel/1. VUB/02. Coding/01. IRRMIP/03. Data/01. Input files/W5E5/01. Regridded/W5E5_MERGED_MASKED_DATA.nc" climate_data = xr.open_dataset(climate_data_path)print(climate_data.lon)print(climate_data.lat)print(climate_data.hgt)# download dem from: https://cluster.klima.uni-bremen.de/data/gdirs/dems_v2/default/RGI62/b_010/L1# download W5E% data from:     #%%  Load requried librariesimport oggmfrom oggm import cfg, utils, workflow, tasks, DEFAULT_BASE_URLimport geopandas as gpdimport numpy as npimport osfrom oggm.shop import rgitopofrom oggm import GlacierDirectoryfrom oggm.core import massbalance, flowline# Libsimport xarray as xrimport matplotlib.pyplot as pltimport matplotlib.cm as cmfrom oggm.shop import cru, w5e5from oggm.tasks import process_w5e5_dataimport matplotlib.pyplot as pltfrom oggm import graphicsimport pandas as pdimport loggingimport shutilimport argparseimport timeimport loggingimport json#%%folder_path='/Users/magaliponds/Documents/00. Programming'wd_path=f'{folder_path}/07. check perturbation-glacier interactions/'sum_dir=os.path.join(wd_path, 'summary')y0_clim=1985ye_clim=2014y0_spinup=1980ye_spinup=2020cmap=cm.get_cmap('bone')colors=[cmap(i / 9) for i in range(10)]# Specify the RGI region you are interested in, for example, region 13 (Central Asia)rgi_reg = '13'  # this must fit to example glacier(s), if starting from level 0rgi_ids = ["RGI60-13.40102", # Area >10km2    "RGI60-13.39195", # Area >10km2    "RGI60-13.36881", # Area >10km2    "RGI60-13.38969", # Area >10km2    "RGI60-13.37184", # Area >10km2    "RGI60-13.00967", # Area <10km2    "RGI60-13.40982", # Area <10km2    "RGI60-13.41891", # WGMS observation    "RGI60-13.23659", # WGMS observation] base_url = ('https://cluster.klima.uni-bremen.de/~oggm/gdirs/oggm_v1.6/L3-L5_files/2023.3/elev_bands/W5E5/')prepro_level=5        cfg.initialize(logging_level='WARNING')cfg.PARAMS['baseline_climate']='W5E5-GWE3P'cfg.PATHS['working_dir'] = utils.mkdir(wd_path, reset=True)gdirs = workflow.init_glacier_directories(    rgi_ids, #using RGI IDS specified before    prepro_base_url=DEFAULT_BASE_URL, #using base_url with W5E5 data    from_prepro_level=5, #using pre-pro level 5, indicating the model has been calibrated, and uses a pre-computed model run from the RGI outline date to the last possible date given by historical climate data    prepro_border=80 #ndicates the number of grid points which weâ€™d like to add to each side of the glacier for the local map    )info=[]for gdir in gdirs:     rgi_id = gdir.rgi_id    lon =  gdir.get_climate_info()['baseline_climate_ref_pix_lon']    lat =  gdir.get_climate_info()['baseline_climate_ref_pix_lat']    hgt =  gdir.get_climate_info()['baseline_climate_ref_hgt']    info.append((rgi_id, lon, lat, hgt))print(info)sum_dir=os.path.join(wd_path, 'summary')os.makedirs(sum_dir, exist_ok=True)opath = os.path.join(sum_dir, "spinup_historical_control_run.nc")ds = utils.compile_run_output(gdirs, path=opath, input_filesuffix='_spinup_historical')workflow.execute_entity_task(tasks.fixed_geometry_mass_balance, gdirs,                                       use_inversion_flowlines=False,                                      ys=1985, ye=2014,                                       monthly_step=False, #not available yet                                      climate_filename='climate_historical',                                      climate_input_filesuffix='')opath_massbalance_before = os.path.join(sum_dir, 'spinup_historical_mb_control_run.csv')utils.compile_fixed_geometry_mass_balance(gdirs, path=opath_massbalance_before, climate_filename='climate_historical',                                           climate_input_filesuffix='', use_inversion_flowlines=False                                          )