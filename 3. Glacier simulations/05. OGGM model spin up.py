""" This script runs the OGGM step by step guide to a preprocessed directory"""#%% Cell 1: Load the required directoriesfrom oggm import cfg, utils, workflow, tasks, DEFAULT_BASE_URLimport geopandas as gpdimport numpy as npimport osfrom oggm.shop import rgitopofrom oggm import GlacierDirectory# Libsimport xarray as xrimport matplotlib.pyplot as pltfrom oggm.shop import cru, w5e5from oggm.tasks import process_w5e5_dataimport matplotlib.pyplot as pltfrom oggm import graphics#%% Cell 2: Set up the model with your own climate datacfg.initialize(logging_level='WARNING')# Use W5E5 datafolder_path_local='/Users/magaliponds/Documents/00. Programming/'# folder_path='/Users/magaliponds/Library/CloudStorage/OneDrive-VrijeUniversiteitBrussel/1. VUB/02. Coding/01. IRRMIP/02. Data/06. OGGM Working Directories'wd_path=f'{folder_path_local}/05. OGGM model spinup'# Local working directory (where OGGM will write its output)cfg.PATHS['working_dir'] = utils.mkdir(wd_path, reset=True)cfg.PATHS['climate_file'] = '/Users/magaliponds/Library/CloudStorage/OneDrive-VrijeUniversiteitBrussel/1. VUB/02. Coding/01. IRRMIP/02. Data/01. Input files/W5E5/huss_W5E5v2.0_20110101-20191231.nc'# cfg.PATHS['climate_file'] = '/path/to/your/climate_data.nc'#%% Cell 3: Download the RGI inventory and set up the glacier directories# Specify the RGI region you are interested in, for example, region 13 (Central Asia)rgi_ids = ["RGI60-13.40102", # Area >10km2    "RGI60-13.39195", # Area >10km2   "RGI160-13.36881", # Area >10km2   "RGI60-13.38969", # Area >10km2   "RGI60-13.37184", # Area >10km2  "RGI60-13.00967", # Area <10km2  "RGI60-13.40982", # Area <10km2   "RGI60-13.41891", # WGMS observation   "RGI60-13.23659", # WGMS observation] rgi_region = '13'  # this must fit to example glacier(s), if starting from level 0# Initialize glacier directories# We use a recent gdir setting, calibated on a glacier per glacier basisbase_url = ('https://cluster.klima.uni-bremen.de/~oggm/gdirs/oggm_v1.6/'            'L3-L5_files/2023.3/elev_bands/W5E5/')# gdirs = workflow.init_glacier_directories(rgi_ids, from_prepro_level=3, prepro_base_url=base_url)# Go - get the pre-processed glacier directories# You have to explicitly indicate the url from where you want to start fromgdirs = workflow.init_glacier_directories(rgi_ids, from_prepro_level=3, prepro_base_url=base_url)# print(gdirs)#%% Cell 4: process glacier directories - From 2 to level 3# workflow.execute_entity_task(tasks.define_glacier_region, gdirs)# workflow.execute_entity_task(tasks.glacier_masks, gdirs)# workflow.execute_entity_task(tasks.compute_centerlines, gdirs)# workflow.execute_entity_task(tasks.initialize_flowlines, gdirs)# workflow.execute_entity_task(tasks.compute_downstream_line, gdirs)# workflow.execute_entity_task(tasks.catchment_area, gdirs)# workflow.execute_entity_task(tasks.catchment_width_geom, gdirs)# workflow.execute_entity_task(tasks.catchment_width_correction, gdirs)# workflow.execute_entity_task(tasks.process_climate_data, gdirs)#%% Cell 5: Prepare your W5E5 climate datay0=1985y1=2019for gdir in gdirs:    process_w5e5_data(gdir, output_filesuffix='_W5E5_data',                          y0=y0, y1=y1)# Load your custom climate data# custom_climate_path = '/Users/magaliponds/Library/CloudStorage/OneDrive-VrijeUniversiteitBrussel/1. VUB/02. Coding/01. IRRMIP/02. Data/01. Input files/CESM2/CESM2.IRR.000.1985_2014_selparam_monthly_total.nc'# custom_climate = xr.open_dataset(custom_climate_path)#%% Cell 6: Force OGGM with your climate data# model='W5E5'def process_custom_climate_data(gdir):    # Assuming you have a NetCDF with 'temp' and 'prcp' variables    with utils.ncDataset(cfg.PATHS['climate_file']) as nc:        time = nc.variables['time'][:]        temp = nc.variables['temp'][:]        prcp = nc.variables['prcp'][:]        # Process and write to glacier directory        gdir.write_monthly_climate_file(time, temp, prcp, filename=f'{model}_climate_output') #Question: why does this not work ?tasks.process_custom_climate_data = process_custom_climate_data# Process climate data for each gdir# see whether to use W5e5 flattened or unflattenedworkflow.execute_entity_task(tasks.process_custom_climate_data, gdirs)#%% Cell 7: How to calibrate the model? #%% Cell 8: Run the dynamic spinup# y0=1985# y1=2019# for gdir in gdirs:#     tasks.run_dynamic_spinup(gdir,#                              spinup_start_yr=y0,  # When to start the spinup#                              minimise_for='area',  # what target to match at the RGI date#                              output_filesuffix='_spinup_dynamic_area',  # Where to write the output#                              ye=y1,  # When the simulation should stop#                              );    #     tasks.run_dynamic_spinup(gdir,#                              spinup_start_yr=y0,  # When to start the spinup#                              minimise_for='volume',  # what target to match at the RGI date#                              output_filesuffix='_spinup_dynamic_volume',  # Where to write the output#                              ye=y1,  # When the simulation should stop#                              );#%% Cell 9: Run the model simulation# Question: From when do we need to run the spinup in order to simulate from 1985 onward# Question: Prepro 3 already has calibration, can I then just start running task? # Question: How to load accurate data files from OGGM shop (W5E5)# Double check if spinup is needed# Example parameters for run_from_climate_datays = 1979  # Start yearye = 2020  # End yearstore_monthly_step = True# climate_filename = f'{model}_climate_output'climate_filename='climate_historical_W5E5_data'workflow.execute_entity_task(tasks.run_from_climate_data, gdirs,                             ys=ys, ye=ye, store_monthly_step=store_monthly_step,                             climate_filename='climate_historical',                             climate_input_filesuffix='_W5E5_data'                             )#%% Cell 10: Analyze the outputfor gdir in gdirs:    graphics.plot_glacier(gdir, title=gdir.rgi_id)    plt.show()